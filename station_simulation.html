<!doctype html>
  <head>
    <script>
      var i = 0;
      var scale = .5;
      var canvas = document.getElementById('station_layout');
      var context = canvas.getContext('2d');
      context.translate(300,500);
      context.save();

      function scatter_particles() {
        if(i!=0) {
          clearCanvas();
          makeCanvas();}
        var number = document.getElementById("density").value,
            canvaswidth = document.getElementById("station_layout").width,
            canvasheight = document.getElementById("station_layout").height;
        var size = canvaswidth * canvasheight / (100 * 100 * scale * scale);
        var number_of_particles = size * number;
        for(i = 0; i < number_of_particles; i++) {
          x = (600 * Math.random());
          y = (600 * Math.random());
          drawParticle(context, x, y);}}
    
      function radians(degrees) {
        return degrees * Math.PI / 180;}

      function drawStation(ctx, r, alpha, beta, color) {
        var detector_width = 50 * scale;
        var detector_height = 100 * scale;

        r = -r * 100 * scale 
        ctx.rotate(radians(alpha));
        ctx.translate(0, r);
        ctx.rotate(-radians(alpha));
        ctx.rotate(radians(beta));
        ctx.fillStyle = color;
        ctx.fillRect(-detector_width / 2, -detector_height / 2,
                     detector_width, detector_height);
        ctx.restore();
        ctx.save()}

      function drawParticle(ctx, x, y) {
        ctx.fillStyle = 'black';
        ctx.fillRect(x-301, y-501, 2, 2);
        ctx.restore();
        ctx.save()}

      function clearCanvas() {
        // Store the current transformation matrix
        context.save();
        // Use the identity matrix while clearing the canvas
        context.setTransform(1, 0, 0, 1, 0, 0);
        context.clearRect(0, 0, canvas.width, canvas.height);
        // Restore the transform
        context.restore();}

      function makeCanvas(){
        context.fillStyle = 'blue';
        context.fillRect(-2.5, -2.5, 5, 5);
        drawStation(context, 8.66, 0, 0, 'gray')
        drawStation(context, 2.66, 0, 0, 'red')
        drawStation(context, 5, -90, 90, 'lightgreen')
        drawStation(context, 5, 90, 90, 'lightblue')}
    </script>
  </head>
  <body onload="makeCanvas()">
    <p>
      Particle density in [m<sup>-2</sup>]: 
      <input type="text" id="density"/>
      <button onclick="scatter_particles()">Start simulation</button>
    </p>
    <canvas id="station_layout" width="600" height="600"></canvas>
  </body>
<html>